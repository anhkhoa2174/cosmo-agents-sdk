# Implementation Plan: Fix Outreach Bugs

**Branch**: `003-fix-outreach-bugs` | **Date**: 2026-02-06 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-fix-outreach-bugs/spec.md`

## Summary

Fix 5 outreach bugs across backend and frontend: (1) auto-transition to NO_REPLY after 8 hours without reply by adding hour-based check to existing state machine, (2) fix draft name placeholder by strengthening AI prompt and adding post-processing, (3) increase meeting prep timeout to 120s with proper error handling, (4) fix stage filter errors for meeting-related stages, (5) add smart meeting time suggestion with overlap detection.

## Technical Context

**Language/Version**: Go 1.21+ (backend), TypeScript 5.7+ / Next.js (frontend)
**Primary Dependencies**: Fiber (HTTP), GORM (ORM), OpenAI (AI generation), React Query, ky (HTTP client), shadcn/ui
**Storage**: PostgreSQL (existing schema, no migrations needed)
**Testing**: `go test` (backend unit), Vitest (frontend/SDK integration)
**Target Platform**: Linux server (backend), Web browser (frontend)
**Project Type**: Web application (backend + frontend, separate repos)
**Performance Goals**: Meeting prep completes within 120s; stage filters respond within 500ms
**Constraints**: No database schema changes; backward-compatible API
**Scale/Scope**: 5 bug fixes across 2 repositories (~10 files changed)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **Specification-First**: Spec.md complete with 5 prioritized user stories (3x P1, 2x P2)
- [x] **Test-First**: Test scenarios defined in acceptance criteria; integration tests from spec 002
- [x] **Code Quality**: Go linting (existing), TypeScript strict mode (existing)
- [x] **UX Consistency**: User flows documented in 16 acceptance scenarios across 5 stories
- [x] **Performance**: Meeting prep timeout = 120s, filter response = 500ms
- [x] **Observability**: Existing logging in worker and service; add logging for 8-hour transitions
- [ ] **Issue Tracking**: No Beads CLI available (relaxed)

**Complexity Violations**: None identified

## Project Structure

### Documentation (this feature)

```text
specs/003-fix-outreach-bugs/
├── plan.md              # This file
├── research.md          # Phase 0 output - root cause analysis for all 5 bugs
├── data-model.md        # Phase 1 output - entity changes and state transitions
├── quickstart.md        # Phase 1 output - implementation guide per bug
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Phase 2 output (generated by /specledger.tasks)
```

### Source Code (affected files)

```text
cosmo-agents-backend/
├── internal/
│   ├── service/outreach/
│   │   └── outreach_service.go       # Bug 1: 8-hour state check
│   │                                  # Bug 2: AI prompt + post-processing
│   ├── handler/v1/outreach/
│   │   └── handler.go                # Bug 3: context.WithTimeout(120s)
│   ├── domain/outreach/
│   │   └── outreach.go               # Bug 1: Config struct (NoReplyHours)
│   └── worker/outreach/
│       └── recalculate_worker.go     # Bug 1: Worker already handles transitions
└── cmd/server/
    └── app.go                        # No change (per-handler timeout preferred)

cosmo-agents-frontend/
├── src/
│   ├── app/(main)/outreach/
│   │   └── page.tsx                  # Bug 4: Stage filter error handling
│   ├── components/contacts/
│   │   └── contact-outreach.tsx      # Bug 3: Timeout hint UI
│   │                                  # Bug 5: Meeting time suggestion
│   ├── network/client/
│   │   └── outreach.ts              # Bug 3: Per-request timeout
│   │                                  # Bug 5: Get all user meetings
│   └── lib/
│       └── meeting-utils.ts          # Bug 5: Time suggestion utility (new file)
```

**Structure Decision**: Web application with separate backend (Go/Fiber) and frontend (Next.js/React). Changes span both repos but no new services or packages needed.

## Implementation Phases

### Phase 1: P1 Bugs (Backend-focused)

| Task | Bug | Scope | Effort |
|------|-----|-------|--------|
| Fix AI prompt for name placeholder | Bug 2 | Backend | Small |
| Add post-processing for [Tên bạn] | Bug 2 | Backend | Small |
| Add 120s timeout to meeting prep handler | Bug 3 | Backend | Small |
| Add timeout to frontend meeting prep call | Bug 3 | Frontend | Small |
| Add 8-hour NO_REPLY config | Bug 1 | Backend | Medium |
| Modify state machine for 8-hour check | Bug 1 | Backend | Medium |

### Phase 2: P2 Bugs (Frontend-focused)

| Task | Bug | Scope | Effort |
|------|-----|-------|--------|
| Debug and fix stage filter errors | Bug 4 | Frontend | Medium |
| Add empty state handling for filters | Bug 4 | Frontend | Small |
| Create meeting time suggestion utility | Bug 5 | Frontend | Medium |
| Add all-user-meetings API endpoint | Bug 5 | Backend | Small |
| Integrate time suggestion into dialog | Bug 5 | Frontend | Medium |

## Complexity Tracking

No violations identified. All changes are targeted fixes within existing architecture.
